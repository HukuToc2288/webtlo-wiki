---
title: "Docker"
weight: 9
---

Скачиваем приложение:
```
mkdir webtlo
wget https://github.com/berkut-174/webtlo/releases/latest/download/webtlo.zip
unzip -o webtlo.zip -d ./webtlo
rm -f webtlo.zip
cd webtlo
```

Создаем Dockerfile:

```
cat <<EOT >> Dockerfile
FROM php:7.2-apache
COPY webtlo.local/ /var/www/html/
EOT
```

Создаем образ:
```
docker build -t webtlo .      
```

Запускаем контейнер:
```
docker run -d -p 1844:80 webtlo
```
приложение будет доступно по адрессу `localhost:1844`. Если торрент-клиент расположен на той же клиентской машине, то нужно использовать  `--network host`. 

Останавливаем контейнер:

**!!!Докер как правило не сохраняет состояние контейнера и можно потерять текущую конфигурацию если забыть сохранить состояние!!!**

```
docker ps # получаем CONTAINER ID, допустим f930eac745e6
docker commit f930eac745e6  webtlo:latest
docker stop f930eac745e6
```

## Докер контейнер с сохранением настроек и доступу к хосту

Не всегда есть возможность использовать сеть хоста для контейнера, банально по причине, что порт 80
уже занят кем-то другим. Также будем использовать volume, это позволит контейнеру использовать
папку в которой лежит webtlo и наши данные. Можно выключать и удалять контейнер - данные не пропадут.

Команда запуска контейнера:
```bash
docker run --name webtlo -v /home/user/webtlo/webtlo.local:/var/www/html -p 1844:80 php:7.2-apache
```
в параметре -v до : впишите полный путь до папки webtlo.local. Если по-простому, папка контейнера 
`/var/www/html` будет смотреть в папку `/home/user/webtlo/webtlo.local` на вашем хосте. Все изменения в
папке `/home/user/webtlo/webtlo.local` отразятся на состоянии приложения в контейнере.

Webtlo доступно по адресе `http://localhost:1844` или замените `localhost` на адрес вашего сервера, на
котором развернут контейнер. При необходимости не забудьте прокинуть порт 1844, если находится сервер за
маршрутизатором.

Так как изначально в webtlo.local нет директории `data`, создайте директорию `data` в `webtlo.local` 

```bash
mkdir data
```

и выдайте ей полные права (да, не best practice, при этом универсально):

```bash
chmod 777 data
```

Контейнер перезагружать не требуется.

### Настройки подключения торрент клиента

Также, чтобы из контейнера обращаться к торрент-клиенту на хосте,
пропишите ip в webtlo, 

Настройки -> Настройки торрент-клиентов -> IP-адрес/сетевое имя: `172.17.0.1`

Кнопкой Проверить убедитесь в работоспособности и сохраните настройки.

`172.17.0.1` - по умолчанию ip хост машины для доступа из докер контейнера. Также если не работает
попробуйте вариант: `host.docker.internal`

И в разделе Настройки -> Настройки загрузки торрент-файлов:
в параметр **Каталог для скачиваемых *.torrent файлов**: /tmp/
и в Скачивание *.torrent файлов с заменой Passkey, Каталог: /tmp/

Не забудьте сохранить все настройки.

## Мотивация
Иногда не хочеться устанавливать полноценний `apache2` сервер и `php` на свою машину или нет готовых инструкций под екзотическую платформу. Docker гарантирует что приложение запустится под любую поддерживаемую ОС и будет работать так же хорошо как и на "базовой" платформе (debian:buster-slim). Также этот метод возможно снизит порог вхождения для некоторых пользователей.

